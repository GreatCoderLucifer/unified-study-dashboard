<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📚 Study & Goal Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #dee2e6;
        }

        .header h1 {
            font-size: 1.75rem;
            font-weight: 600;
            color: #1a365d;
        }

        .header-info {
            color: #6c757d;
            font-size: 0.9rem;
            text-align: right;
        }

        /* Main countdown section */
        .countdown-hero {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            text-align: center;
        }

        .countdown-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1a365d;
            margin-bottom: 25px;
        }

        .time-display {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }

        .time-unit {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 80px;
        }

        .time-value {
            font-size: 2.8rem;
            font-weight: 700;
            color: #1a365d;
            font-family: 'SF Mono', Monaco, monospace;
        }

        .time-label {
            font-size: 0.8rem;
            color: #6c757d;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 5px;
        }

        .time-separator {
            font-size: 2rem;
            color: #6c757d;
            margin-top: 10px;
        }

        .progress-section {
            margin-top: 25px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .progress-label {
            color: #495057;
            margin-bottom: 10px;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            font-weight: 500;
        }

        .progress-percentage {
            color: #28a745;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        /* Day timer */
        .day-timer {
            background: white;
            border-radius: 6px;
            padding: 12px 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .day-timer-label {
            font-size: 0.85rem;
            color: #6c757d;
            font-weight: 500;
        }

        .day-timer-display {
            font-size: 1.5rem;
            font-weight: 600;
            font-family: 'SF Mono', Monaco, monospace;
            color: #1a365d;
        }

        .day-timer-status {
            font-size: 0.75rem;
            color: #6c757d;
            padding: 4px 8px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        /* Grid layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .section {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1a365d;
        }

        /* Phase cards */
        .phase-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #1a365d;
        }

        .phase-card h3 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #1a365d;
            font-weight: 600;
        }

        .phase-card p {
            font-size: 0.9rem;
            color: #6c757d;
            line-height: 1.4;
            margin-bottom: 15px;
        }

        .mini-timer {
            font-size: 0.95rem;
            font-weight: 600;
            color: #1a365d;
            text-align: center;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            font-family: 'SF Mono', Monaco, monospace;
        }

        /* Timer section */
        .timer-display-large {
            font-size: 4rem;
            font-weight: 300;
            font-family: 'SF Mono', Monaco, monospace;
            text-align: center;
            margin: 20px 0;
            color: #1a365d;
        }

        .timer-status {
            text-align: center;
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .timer-controls {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }

        .timer-controls label {
            font-size: 0.9rem;
            color: #495057;
        }

        .timer-controls input[type="number"] {
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.9rem;
            text-align: center;
        }

        .quick-time {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-time:hover {
            background: #e9ecef;
        }

        .note-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.9rem;
            margin-bottom: 20px;
            resize: none;
        }

        .control-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #1a365d;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #2c5282;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #5a6268;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Stats cards */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1a365d;
        }

        .stat-sublabel {
            font-size: 0.75rem;
            color: #6c757d;
            margin-top: 2px;
        }

        .bonus-section {
            text-align: right;
        }

        .bonus-value {
            font-size: 1.75rem;
            font-weight: 600;
            color: #1a365d;
        }

        /* Activity log */
        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .activity-controls {
            display: flex;
            gap: 10px;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid #1a365d;
            color: #1a365d;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-outline:hover {
            background: #1a365d;
            color: white;
        }

        .log-entry {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .log-info {
            flex: 1;
        }

        .log-date {
            font-weight: 600;
            color: #1a365d;
            font-size: 0.9rem;
        }

        .log-duration {
            color: #28a745;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .log-note {
            color: #6c757d;
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .no-logs {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 12px;
            border-radius: 6px;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .success-msg {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 12px;
            border-radius: 6px;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .notes-text {
            font-size: 0.8rem;
            color: #6c757d;
            line-height: 1.4;
            margin-top: 15px;
        }

        @media (max-width: 1024px) {
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .timer-controls {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .control-buttons {
                grid-template-columns: 1fr 1fr;
            }

            .time-display {
                gap: 10px;
            }

            .time-value {
                font-size: 2.2rem;
            }

            .time-separator {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Study & Goal Dashboard</h1>
            <div class="header-info">
                <div>Target: May 3, 2026</div>
                <div>Monthly Goal: <strong id="headerGoal">420h</strong></div>
            </div>
        </div>

        <!-- Main Countdown to May 3, 2026 -->
        <div class="countdown-hero">
            <div class="countdown-title">Countdown to May 3, 2026</div>
            <div class="time-display">
                <div class="time-unit">
                    <span id="mainMonths" class="time-value">--</span>
                    <div class="time-label">Months</div>
                </div>
                <div class="time-separator">:</div>
                <div class="time-unit">
                    <span id="mainDays" class="time-value">--</span>
                    <div class="time-label">Days</div>
                </div>
                <div class="time-separator">:</div>
                <div class="time-unit">
                    <span id="mainHours" class="time-value">--</span>
                    <div class="time-label">Hours</div>
                </div>
                <div class="time-separator">:</div>
                <div class="time-unit">
                    <span id="mainMinutes" class="time-value">--</span>
                    <div class="time-label">Minutes</div>
                </div>
                <div class="time-separator">:</div>
                <div class="time-unit">
                    <span id="mainSeconds" class="time-value">--</span>
                    <div class="time-label">Seconds</div>
                </div>
            </div>
            <div class="progress-section">
                <div class="progress-label">
                    <span>Current month progress</span>
                    <span id="monthProgress" class="progress-percentage">0.0%</span>
                </div>
                <div class="progress-bar">
                    <div id="monthProgressFill" class="progress-fill" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Day Timer -->
        <div class="day-timer">
            <div class="day-timer-label">⏰ Day Time Left:</div>
            <div class="day-timer-display" id="dayTimerDisplay">00:00:00</div>
            <div class="day-timer-status" id="dayTimerStatus">Calculating...</div>
        </div>

        <!-- Phase Cards -->
        <div class="grid-3">
            <div class="phase-card">
                <h3>Phase 1: Backlog Clearing</h3>
                <p>1 month to clear backlog and align with live classes.</p>
                <div class="mini-timer" id="phase1Timer">
                    <span class="phase-days">--</span>d : <span class="phase-hours">--</span>h : <span class="phase-minutes">--</span>m
                </div>
            </div>
            <div class="phase-card">
                <h3>Phase 2: Securing 650+</h3>
                <p>3 months after backlog clearing to secure 650+ in tests.</p>
                <div class="mini-timer" id="phase2Timer">
                    <span class="phase-days">--</span>d : <span class="phase-hours">--</span>h : <span class="phase-minutes">--</span>m
                </div>
            </div>
            <div class="phase-card">
                <h3>Phase 3: Test & Revision</h3>
                <p>Final test practice, mistake review, and full revision.</p>
                <div class="mini-timer" id="phase3Timer">
                    <span class="phase-days">--</span>d : <span class="phase-hours">--</span>h : <span class="phase-minutes">--</span>m
                </div>
            </div>
        </div>

        <!-- Study Timer and Monthly Goal -->
        <div class="grid-2">
            <div class="section">
                <h2 class="section-title">Study Timer</h2>
                <div class="timer-display-large" id="timerDisplay">00:00:00</div>
                <div class="timer-status" id="timerStatus">Ready</div>
                
                <div class="timer-controls">
                    <label>Hours</label>
                    <input type="number" id="hours" min="0" max="23" value="0">
                    <label>Minutes</label>
                    <input type="number" id="minutes" min="0" max="59" value="45">
                    <label>Seconds</label>
                    <input type="number" id="seconds" min="0" max="59" value="0">
                </div>
                
                <div class="timer-controls">
                    <button class="quick-time" onclick="setQuickTime(30, 0)">30m</button>
                    <button class="quick-time" onclick="setQuickTime(45, 0)">45m</button>
                    <button class="quick-time" onclick="setQuickTime(1, 0, true)">1h</button>
                    <span></span><span></span><span></span>
                </div>
                
                <textarea class="note-input" id="sessionNote" placeholder="Add a note for this session (optional)" rows="2"></textarea>
                
                <div class="control-buttons">
                    <button class="btn btn-primary" id="startBtn">Start</button>
                    <button class="btn btn-secondary" id="pauseBtn" disabled>Pause</button>
                    <button class="btn btn-secondary" id="resumeBtn" disabled>Resume</button>
                    <button class="btn btn-secondary" id="resetBtn">Reset</button>
                </div>
                
                <div style="text-align: center; font-size: 0.8rem; color: #6c757d;">
                    Tab title updates while timer runs.
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">Monthly Goal</h2>
                
                <div style="background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 0.85rem; color: #6c757d; margin-bottom: 20px;">
                    Goal formula: 14 hours × Days in month
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Monthly Goal</div>
                        <div class="stat-value" id="monthlyGoal">420h</div>
                        <div class="stat-sublabel" id="goalDetails">(14 × days)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Time Studied</div>
                        <div class="stat-value" id="timeStudied">0.0h</div>
                        <div class="stat-sublabel">This month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Remaining</div>
                        <div class="stat-value" id="remainingTime">420.0h</div>
                        <div class="stat-sublabel">Left this month</div>
                    </div>
                </div>
                
                <div class="bonus-section">
                    <div class="stat-label">Bonus Hours</div>
                    <div class="bonus-value" id="bonusHours">0.0h</div>
                </div>
                
                <div class="stat-card" style="margin: 15px 0; border-left: 4px solid #6c757d;">
                    <div class="stat-label" style="color: #6c757d;">Max Possible Hours Left</div>
                    <div class="stat-value" style="color: #1a365d;" id="maxPossibleHours">--</div>
                </div>
                
                <div class="stat-card" style="margin: 15px 0; border-left: 4px solid #28a745;">
                    <div class="stat-label" style="color: #28a745;">Today's Date</div>
                    <div class="stat-value" style="color: #28a745; font-size: 1rem;" id="todaysDate">--</div>
                </div>
                
                <div class="notes-text">
                    <strong>Notes:</strong> Every completed session auto-logs and deducts from monthly remaining time. Overage tracked as bonus.
                </div>
                
                <div id="warningMessage"></div>
            </div>
        </div>

        <!-- Activity Log -->
        <div class="section">
            <div class="activity-header">
                <h2 class="section-title" style="margin: 0;">Activity Log</h2>
                <div class="activity-controls">
                    <button class="btn-outline" id="showTodayBtn">Show Today's Logs</button>
                    <button class="btn-outline" id="exportBtn">Export as CSV</button>
                    <button class="btn-outline" id="clearLogsBtn">Clear All Logs</button>
                </div>
            </div>
            <div id="logContainer">
                <div class="no-logs">No logs yet</div>
            </div>
            <div style="text-align: center; font-size: 0.8rem; color: #6c757d; margin-top: 20px; padding-top: 20px; border-top: 1px solid #dee2e6;">
                Data persists in your browser until you clear logs manually or clear browser storage.
            </div>
        </div>
    </div>

    <script>
        class UnifiedDashboard {
            constructor() {
                this.timer = null;
                this.totalSeconds = 0;
                this.currentSeconds = 0;
                this.isRunning = false;
                this.isPaused = false;
                this.originalTitle = document.title;
                this.showingTodayOnly = false;
                this.dayTimer = null;
                
                this.TARGET_DATE = new Date('2026-05-03T00:00:00+05:30');
                this.PHASE1_END = new Date('2025-10-17T00:00:00+05:30');
                this.PHASE2_END = new Date('2026-01-17T00:00:00+05:30');
                this.PHASE3_END = new Date('2026-05-02T00:00:00+05:30');
                
                this.initializeElements();
                this.loadData();
                this.bindEvents();
                this.updateAll();
                this.startTimers();
            }
            
            initializeElements() {
                this.elements = {
                    mainMonths: document.getElementById('mainMonths'),
                    mainDays: document.getElementById('mainDays'),
                    mainHours: document.getElementById('mainHours'),
                    mainMinutes: document.getElementById('mainMinutes'),
                    mainSeconds: document.getElementById('mainSeconds'),
                    monthProgress: document.getElementById('monthProgress'),
                    monthProgressFill: document.getElementById('monthProgressFill'),
                    dayTimerDisplay: document.getElementById('dayTimerDisplay'),
                    dayTimerStatus: document.getElementById('dayTimerStatus'),
                    hours: document.getElementById('hours'),
                    minutes: document.getElementById('minutes'),
                    seconds: document.getElementById('seconds'),
                    sessionNote: document.getElementById('sessionNote'),
                    timerDisplay: document.getElementById('timerDisplay'),
                    timerStatus: document.getElementById('timerStatus'),
                    startBtn: document.getElementById('startBtn'),
                    pauseBtn: document.getElementById('pauseBtn'),
                    resumeBtn: document.getElementById('resumeBtn'),
                    resetBtn: document.getElementById('resetBtn'),
                    headerGoal: document.getElementById('headerGoal'),
                    monthlyGoal: document.getElementById('monthlyGoal'),
                    goalDetails: document.getElementById('goalDetails'),
                    timeStudied: document.getElementById('timeStudied'),
                    remainingTime: document.getElementById('remainingTime'),
                    bonusHours: document.getElementById('bonusHours'),
                    maxPossibleHours: document.getElementById('maxPossibleHours'),
                    todaysDate: document.getElementById('todaysDate'),
                    warningMessage: document.getElementById('warningMessage'),
                    showTodayBtn: document.getElementById('showTodayBtn'),
                    clearLogsBtn: document.getElementById('clearLogsBtn'),
                    exportBtn: document.getElementById('exportBtn'),
                    logContainer: document.getElementById('logContainer')
                };
            }
            
            bindEvents() {
                this.elements.startBtn.addEventListener('click', () => this.startTimer());
                this.elements.pauseBtn.addEventListener('click', () => this.pauseTimer());
                this.elements.resumeBtn.addEventListener('click', () => this.resumeTimer());
                this.elements.resetBtn.addEventListener('click', () => this.resetTimer());
                this.elements.showTodayBtn.addEventListener('click', () => this.toggleTodayLogs());
                this.elements.clearLogsBtn.addEventListener('click', () => this.clearLogs());
                this.elements.exportBtn.addEventListener('click', () => this.exportToCSV());
                
                [this.elements.hours, this.elements.minutes, this.elements.seconds].forEach(input => {
                    input.addEventListener('input', () => this.updateTimerDisplay());
                });
            }
            
            loadData() {
                const savedData = localStorage.getItem('studyTrackerData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    this.logs = data.logs || [];
                    this.studiedHours = data.studiedHours || 0;
                    this.bonusHours = data.bonusHours || 0;
                } else {
                    this.logs = [];
                    this.studiedHours = 0;
                    this.bonusHours = 0;
                }
                this.renderLogs();
            }
            
            saveData() {
                const data = {
                    logs: this.logs,
                    studiedHours: this.studiedHours,
                    bonusHours: this.bonusHours
                };
                localStorage.setItem('studyTrackerData', JSON.stringify(data));
            }
            
            startTimers() {
                // Update all timers immediately first
                this.updateAllTimers();
                
                // Then set up intervals
                setInterval(() => {
                    this.updateAllTimers();
                }, 1000);
                
                setInterval(() => {
                    this.updatePhaseTimers();
                    this.updateMonthlyStats();
                }, 60000);
            }
            
            updateAllTimers() {
                const now = new Date();
                this.updateMainCountdown(now);
                this.updateDayTimer(now);
            }
            
            updateMainCountdown(currentTime = new Date()) {
                const diff = this.TARGET_DATE - currentTime;
                
                if (diff <= 0) {
                    this.elements.mainMonths.textContent = '00';
                    this.elements.mainDays.textContent = '00';
                    this.elements.mainHours.textContent = '00';
                    this.elements.mainMinutes.textContent = '00';
                    this.elements.mainSeconds.textContent = '00';
                    return;
                }
                
                const months = Math.floor(diff / (1000 * 60 * 60 * 24 * 30));
                const days = Math.floor((diff % (1000 * 60 * 60 * 24 * 30)) / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                this.elements.mainMonths.textContent = months.toString().padStart(2, '0');
                this.elements.mainDays.textContent = days.toString().padStart(2, '0');
                this.elements.mainHours.textContent = hours.toString().padStart(2, '0');
                this.elements.mainMinutes.textContent = minutes.toString().padStart(2, '0');
                this.elements.mainSeconds.textContent = seconds.toString().padStart(2, '0');
                
                const monthProgress = this.calculateMonthProgress(currentTime);
                this.elements.monthProgress.textContent = `${monthProgress.toFixed(1)}%`;
                this.elements.monthProgressFill.style.width = `${monthProgress}%`;
            }
            
            updateAll() {
                const now = new Date();
                this.updateMainCountdown(now);
                this.updatePhaseTimers();
                this.updateDayTimer(now);
                this.updateMonthlyStats();
                this.updateTimerDisplay();
            }
            
            calculateMonthProgress(currentDate) {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const monthStart = new Date(year, month, 1);
                const monthEnd = new Date(year, month + 1, 1);
                const totalDays = (monthEnd - monthStart) / (1000 * 60 * 60 * 24);
                const daysElapsed = (currentDate - monthStart) / (1000 * 60 * 60 * 24);
                return Math.min((daysElapsed / totalDays) * 100, 100);
            }
            
            updatePhaseTimers() {
                this.updatePhaseTimer(this.PHASE1_END, 'phase1Timer');
                this.updatePhaseTimer(this.PHASE2_END, 'phase2Timer');
                this.updatePhaseTimer(this.PHASE3_END, 'phase3Timer');
            }
            
            updatePhaseTimer(targetDate, containerId) {
                const now = new Date();
                const diff = targetDate - now;
                const container = document.getElementById(containerId);
                
                if (!container) return;
                
                if (diff <= 0) {
                    container.innerHTML = "Completed ✅";
                    return;
                }
                
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                
                container.innerHTML = `<span class="phase-days">${days}</span>d : <span class="phase-hours">${hours}</span>h : <span class="phase-minutes">${minutes}</span>m`;
            }
            
            updateDayTimer(currentTime = new Date()) {
                const currentHour = currentTime.getHours();
                const currentMinute = currentTime.getMinutes();
                const currentSecond = currentTime.getSeconds();
                
                const startHour = 4;
                const endHour = 24;
                const currentTimeInSeconds = (currentHour * 3600) + (currentMinute * 60) + currentSecond;
                const startTimeInSeconds = startHour * 3600;
                const endTimeInSeconds = endHour * 3600;
                
                let remainingSeconds;
                let status;
                
                if (currentHour >= 0 && currentHour < 4) {
                    remainingSeconds = startTimeInSeconds - currentTimeInSeconds;
                    status = 'Sleep Time 😴';
                    this.elements.dayTimerDisplay.style.color = '#6c757d';
                } else {
                    remainingSeconds = endTimeInSeconds - currentTimeInSeconds;
                    status = 'Active Day ⚡';
                    this.elements.dayTimerDisplay.style.color = '#1a365d';
                }
                
                const hours = Math.floor(remainingSeconds / 3600);
                const minutes = Math.floor((remainingSeconds % 3600) / 60);
                const seconds = remainingSeconds % 60;
                
                this.elements.dayTimerDisplay.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                this.elements.dayTimerStatus.textContent = status;
            }
            
            getMonthlyGoal() {
                const now = new Date();
                const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
                return daysInMonth * 14;
            }
            
            getRemainingDays() {
                const now = new Date();
                const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
                const today = now.getDate();
                return lastDay - today + 1;
            }
            
            updateMonthlyStats() {
                const monthlyGoal = this.getMonthlyGoal();
                const now = new Date();
                const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
                const currentDay = now.getDate();
                const remainingDays = this.getRemainingDays();
                const maxPossibleHours = remainingDays * 14;
                const remainingRequired = Math.max(0, monthlyGoal - this.studiedHours);
                
                this.elements.headerGoal.textContent = `${monthlyGoal}h`;
                this.elements.monthlyGoal.textContent = `${monthlyGoal}h`;
                this.elements.goalDetails.textContent = `(14 × ${daysInMonth} days)`;
                this.elements.timeStudied.textContent = `${this.studiedHours.toFixed(1)}h`;
                this.elements.remainingTime.textContent = `${remainingRequired.toFixed(1)}h`;
                this.elements.bonusHours.textContent = `${this.bonusHours.toFixed(1)}h`;
                this.elements.maxPossibleHours.textContent = `${maxPossibleHours}h (${remainingDays} days)`;
                this.elements.todaysDate.textContent = 
                    `${now.toLocaleDateString('en-GB')} - Day ${currentDay}/${daysInMonth}`;
                
                if (maxPossibleHours < remainingRequired && remainingRequired > 0) {
                    this.elements.warningMessage.innerHTML = 
                        `<div class="warning">⚠️ Monthly goal no longer achievable. Max: ${maxPossibleHours}h (${remainingDays} days × 14)</div>`;
                } else if (remainingRequired <= 0) {
                    this.elements.warningMessage.innerHTML = 
                        `<div class="success-msg">🎉 Monthly goal achieved! All additional time goes to bonus hours.</div>`;
                } else if (remainingDays <= 3 && remainingRequired > maxPossibleHours * 0.8) {
                    this.elements.warningMessage.innerHTML = 
                        `<div class="warning">📅 Only ${remainingDays} days remaining. Need ${remainingRequired.toFixed(1)}h, max possible: ${maxPossibleHours}h</div>`;
                } else {
                    this.elements.warningMessage.innerHTML = '';
                }
            }
            
            updateTimerDisplay() {
                if (!this.isRunning && !this.isPaused) {
                    const hours = parseInt(this.elements.hours.value) || 0;
                    const minutes = parseInt(this.elements.minutes.value) || 0;
                    const seconds = parseInt(this.elements.seconds.value) || 0;
                    this.totalSeconds = (hours * 3600) + (minutes * 60) + seconds;
                    this.currentSeconds = this.totalSeconds;
                }
                
                const hours = Math.floor(this.currentSeconds / 3600);
                const minutes = Math.floor((this.currentSeconds % 3600) / 60);
                const seconds = this.currentSeconds % 60;
                
                const display = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                this.elements.timerDisplay.textContent = display;
                
                if (this.isRunning) {
                    this.elements.timerStatus.textContent = 'Running';
                    document.title = `⏳ ${display} - Study Timer`;
                } else if (this.isPaused) {
                    this.elements.timerStatus.textContent = 'Paused';
                    document.title = `⏸️ Paused - Study Timer`;
                } else if (this.currentSeconds === 0 && this.totalSeconds > 0) {
                    this.elements.timerStatus.textContent = 'Completed';
                    document.title = `✅ Done - Study Timer`;
                } else {
                    this.elements.timerStatus.textContent = 'Ready';
                    document.title = this.originalTitle;
                }
            }
            
            startTimer() {
                if (this.totalSeconds === 0) {
                    const hours = parseInt(this.elements.hours.value) || 0;
                    const minutes = parseInt(this.elements.minutes.value) || 0;
                    const seconds = parseInt(this.elements.seconds.value) || 0;
                    this.totalSeconds = (hours * 3600) + (minutes * 60) + seconds;
                    this.currentSeconds = this.totalSeconds;
                }
                
                if (this.totalSeconds === 0) {
                    alert('Please set a valid time duration');
                    return;
                }
                
                this.isRunning = true;
                this.isPaused = false;
                
                this.elements.startBtn.disabled = true;
                this.elements.pauseBtn.disabled = false;
                this.elements.resumeBtn.disabled = true;
                
                this.timer = setInterval(() => {
                    this.currentSeconds--;
                    this.updateTimerDisplay();
                    
                    if (this.currentSeconds <= 0) {
                        this.completeSession();
                    }
                }, 1000);
            }
            
            pauseTimer() {
                this.isRunning = false;
                this.isPaused = true;
                clearInterval(this.timer);
                
                this.elements.startBtn.disabled = true;
                this.elements.pauseBtn.disabled = true;
                this.elements.resumeBtn.disabled = false;
            }
            
            resumeTimer() {
                this.startTimer();
            }
            
            resetTimer() {
                this.isRunning = false;
                this.isPaused = false;
                clearInterval(this.timer);
                
                this.currentSeconds = 0;
                this.totalSeconds = 0;
                
                this.elements.startBtn.disabled = false;
                this.elements.pauseBtn.disabled = true;
                this.elements.resumeBtn.disabled = true;
                
                this.updateTimerDisplay();
            }
            
            completeSession() {
                this.isRunning = false;
                this.isPaused = false;
                clearInterval(this.timer);
                
                const studiedHours = this.totalSeconds / 3600;
                const note = this.elements.sessionNote.value || 'No note added';
                const date = new Date().toLocaleString();
                
                this.logs.unshift({
                    date: date,
                    duration: studiedHours,
                    note: note,
                    id: Date.now()
                });
                
                const monthlyGoal = this.getMonthlyGoal();
                if (this.studiedHours < monthlyGoal) {
                    const remainingToGoal = monthlyGoal - this.studiedHours;
                    if (studiedHours <= remainingToGoal) {
                        this.studiedHours += studiedHours;
                    } else {
                        this.studiedHours = monthlyGoal;
                        this.bonusHours += studiedHours - remainingToGoal;
                    }
                } else {
                    this.bonusHours += studiedHours;
                }
                
                this.elements.startBtn.disabled = false;
                this.elements.pauseBtn.disabled = true;
                this.elements.resumeBtn.disabled = true;
                this.elements.sessionNote.value = '';
                
                this.saveData();
                this.renderLogs();
                this.updateMonthlyStats();
                
                this.currentSeconds = 0;
                this.totalSeconds = 0;
                this.updateTimerDisplay();
                
                alert(`🎉 Study session completed!\nDuration: ${studiedHours.toFixed(1)} hours\nNote: ${note}`);
            }
            
            renderLogs() {
                const logsToShow = this.showingTodayOnly ? this.getTodayLogs() : this.logs;
                
                if (logsToShow.length === 0) {
                    const message = this.showingTodayOnly ? "No logs for today yet" : "No logs yet";
                    this.elements.logContainer.innerHTML = `<div class="no-logs">${message}</div>`;
                    return;
                }
                
                const logsHTML = logsToShow.map(log => `
                    <div class="log-entry">
                        <div class="log-info">
                            <div class="log-date">${log.date}</div>
                            <div class="log-duration">${log.duration.toFixed(1)} hours</div>
                            <div class="log-note">${log.note}</div>
                        </div>
                        <button class="delete-btn" onclick="dashboard.deleteLog(${log.id})">Delete</button>
                    </div>
                `).join('');
                
                this.elements.logContainer.innerHTML = logsHTML;
            }
            
            getTodayLogs() {
                const today = new Date().toDateString();
                return this.logs.filter(log => {
                    const logDate = new Date(log.date).toDateString();
                    return logDate === today;
                });
            }
            
            toggleTodayLogs() {
                this.showingTodayOnly = !this.showingTodayOnly;
                this.elements.showTodayBtn.textContent = 
                    this.showingTodayOnly ? 'Show All Logs' : 'Show Today\'s Logs';
                this.renderLogs();
            }
            
            deleteLog(id) {
                if (confirm('Are you sure you want to delete this log entry?')) {
                    const logIndex = this.logs.findIndex(log => log.id === id);
                    if (logIndex > -1) {
                        const deletedLog = this.logs[logIndex];
                        
                        if (this.bonusHours > 0) {
                            if (deletedLog.duration <= this.bonusHours) {
                                this.bonusHours -= deletedLog.duration;
                            } else {
                                const excessToRemove = deletedLog.duration - this.bonusHours;
                                this.bonusHours = 0;
                                this.studiedHours = Math.max(0, this.studiedHours - excessToRemove);
                            }
                        } else {
                            this.studiedHours = Math.max(0, this.studiedHours - deletedLog.duration);
                        }
                        
                        this.logs.splice(logIndex, 1);
                        this.saveData();
                        this.renderLogs();
                        this.updateMonthlyStats();
                    }
                }
            }
            
            clearLogs() {
                if (confirm('Are you sure you want to clear all logs? This action cannot be undone.')) {
                    this.logs = [];
                    this.studiedHours = 0;
                    this.bonusHours = 0;
                    this.saveData();
                    this.renderLogs();
                    this.updateMonthlyStats();
                }
            }
            
            exportToCSV() {
                if (this.logs.length === 0) {
                    alert('No data to export');
                    return;
                }
                
                const headers = ['Date', 'Duration (hours)', 'Note'];
                const csvContent = [
                    headers.join(','),
                    ...this.logs.map(log => [
                        `"${log.date}"`,
                        log.duration.toFixed(1),
                        `"${log.note}"`
                    ].join(','))
                ].join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `study-logs-${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                URL.revokeObjectURL(url);
            }
        }
        
        function setQuickTime(hours, minutes, isHours = false) {
            if (isHours) {
                document.getElementById('hours').value = hours;
                document.getElementById('minutes').value = 0;
            } else {
                document.getElementById('hours').value = 0;
                document.getElementById('minutes').value = hours;
            }
            document.getElementById('seconds').value = 0;
            dashboard.updateTimerDisplay();
        }
        
        const dashboard = new UnifiedDashboard();
        
        window.addEventListener('beforeunload', function(e) {
            if (dashboard.isRunning) {
                e.preventDefault();
                e.returnValue = 'You have a running timer. Are you sure you want to leave?';
                return 'You have a running timer. Are you sure you want to leave?';
            }
        });
    </script>
</body>
</html>
